# Test KEYS pattern matching

redisConnect(url: String) = __native__("Redis.connect", url)
redisSet(conn, key: String, value: String) = { __native__("Redis.set", conn, key, value); receive { msg -> msg } }
redisDel(conn, key: String) = { __native__("Redis.del", conn, key); receive { msg -> msg } }
redisKeys(conn, pattern: String) = { __native__("Redis.keys", conn, pattern); receive { msg -> msg } }

isOk(result) = match result { ("ok", _) -> true, _ -> false }
check(name: String, ok: Bool) = if ok then println("  PASS: " ++ name) else println("  FAIL: " ++ name)

main() = {
    println("=== Testing KEYS Pattern ===")
    conn = redisConnect("redis://127.0.0.1/")

    # Clean up first
    redisDel(conn, "test:keys:a")
    redisDel(conn, "test:keys:b")
    redisDel(conn, "test:keys:c")

    # Create test keys
    redisSet(conn, "test:keys:a", "1")
    redisSet(conn, "test:keys:b", "2")
    redisSet(conn, "test:keys:c", "3")

    ("ok", keys) = redisKeys(conn, "test:keys:*")
    check("KEYS pattern", length(keys) == 3)

    # Cleanup
    redisDel(conn, "test:keys:a")
    redisDel(conn, "test:keys:b")
    redisDel(conn, "test:keys:c")

    println("KEYS tests completed!")
    0
}
