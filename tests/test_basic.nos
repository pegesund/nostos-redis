# Test basic Redis operations

redisConnect(url: String) = __native__("Redis.connect", url)
redisGet(conn, key: String) = { __native__("Redis.get", conn, key); receive { msg -> msg } }
redisSet(conn, key: String, value: String) = { __native__("Redis.set", conn, key, value); receive { msg -> msg } }
redisDel(conn, key: String) = { __native__("Redis.del", conn, key); receive { msg -> msg } }
redisExists(conn, key: String) = { __native__("Redis.exists", conn, key); receive { msg -> msg } }
redisPing(conn) = { __native__("Redis.ping", conn); receive { msg -> msg } }

isOk(result) = match result { ("ok", _) -> true, _ -> false }
check(name: String, ok: Bool) = if ok then println("  PASS: " ++ name) else println("  FAIL: " ++ name)

main() = {
    println("=== Testing Basic Operations ===")
    conn = redisConnect("redis://127.0.0.1/")

    check("PING", isOk(redisPing(conn)))

    redisDel(conn, "test:key")
    check("SET", isOk(redisSet(conn, "test:key", "hello")))

    ("ok", val) = redisGet(conn, "test:key")
    check("GET", val == "hello")

    ("ok", exists) = redisExists(conn, "test:key")
    check("EXISTS", exists == true)
    redisDel(conn, "test:key")

    println("Basic tests completed!")
    0
}
